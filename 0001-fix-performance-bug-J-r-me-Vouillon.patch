From d5838369130057d207a8140c426d0394989951f2 Mon Sep 17 00:00:00 2001
From: gerd <gerd@5e68ba05-c9cc-0310-a7d4-dca2aa431786>
Date: Mon, 14 Jan 2013 16:35:19 +0000
Subject: [PATCH] =?UTF-8?q?fix=20performance=20bug,=20J=C3=A9r=C3=B4me=20V?=
 =?UTF-8?q?ouillon?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

git-svn-id: https://godirepo.camlcity.org/svn/lib-findlib/trunk@185 5e68ba05-c9cc-0310-a7d4-dca2aa431786
---
 doc/README.xml         | 7 ++++++-
 src/findlib/fl_args.ml | 4 +++-
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/doc/README.xml b/doc/README.xml
index 36143f0..d964fc5 100644
--- a/doc/README.xml
+++ b/doc/README.xml
@@ -1,4 +1,4 @@
-<?xml version="1.0" encoding="ISO-8859-1"?>
+<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE readme SYSTEM "readme.dtd" [
 
 <!ENTITY % common SYSTEM "common.xml">
@@ -110,6 +110,11 @@ configuration files, and library routines in detail.</p>
     <ul>
 
     <li>
+      <p><em>SVN:</em> Fixed performance bug when many arguments
+need to be processed (Jérôme Vouillon).</p>
+    </li>
+
+    <li>
       <p><em>1.3.3:</em> OCaml-4: using the new #remove_directory directive
 	if present.</p>
       <p>Better compatibility with the OCaml version from Homebrew.</p>
diff --git a/src/findlib/fl_args.ml b/src/findlib/fl_args.ml
index 885dbc2..2bca50c 100644
--- a/src/findlib/fl_args.ml
+++ b/src/findlib/fl_args.ml
@@ -75,7 +75,9 @@ let rewrite_contracted_args spec contracted_opts args =
           arg1 :: arg2 :: rewrite args_rest
       | arg :: args_rest ->
           ( try
-              expand arg contracted_opts @ rewrite args_rest
+              let args1 = expand arg contracted_opts in
+              let args2 = rewrite args_rest in
+	      args1 @ args2
             with
               | Not_found ->
                   arg :: rewrite args_rest
-- 
2.10.2

